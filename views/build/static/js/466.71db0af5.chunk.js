"use strict";(self.webpackChunknode_complete_social_network_prep=self.webpackChunknode_complete_social_network_prep||[]).push([[466],{2466:(t,e,n)=>{n.r(e),n.d(e,{default:()=>B});var a=n(5043),o=n(9958),l=n(6446),i=n(8903),s=n(1637),r=n(5865),c=n(9135),d=n(2110),u=n(6494),h=n(7600),p=n(1906),m=n(5475),g=n(579);const x=t=>{let{author:e,date:n,title:a,id:o,onStartEdit:l,onDelete:i}=t;return(0,g.jsxs)(d.A,{sx:{m:2,width:"70%",mx:"auto"},children:[(0,g.jsxs)(u.A,{children:[(0,g.jsxs)(r.A,{variant:"body1",color:"text.secondary",children:["Posted by ",e," on ",n]}),(0,g.jsx)(r.A,{variant:"h5",color:"text.primary",children:a})]}),(0,g.jsxs)(h.A,{sx:{justifyContent:"flex-end"},children:[(0,g.jsx)(m.N_,{to:o,children:(0,g.jsx)(p.A,{variant:"text",children:"View"})}),(0,g.jsx)(p.A,{variant:"text",onClick:l,children:"Edit"}),(0,g.jsx)(p.A,{variant:"text",color:"error",onClick:i,children:"Delete"})]})]})},v=t=>{let{link:e,onClick:n,disabled:a,loading:o,type:l,children:i}=t;return e?(0,g.jsx)(p.A,{component:m.N_,to:e,children:i}):(0,g.jsx)(p.A,{onClick:n,disabled:a||o,type:l,variant:"contained",style:{backgroundColor:"#fab83f"},children:o?"Loading...":i})};var j=n(8935),y=n(6240),f=n(1130);const w=t=>{let{control:e,id:n,label:a,required:o,value:i,placeholder:s,onChange:r,onBlur:c,minRows:d}=t;const u=(0,y.A)();return"input"===e?(0,g.jsxs)(l.A,{margin:1,children:[(0,g.jsx)("label",{htmlFor:n,children:a}),(0,g.jsx)(f.h,{id:n,required:o,value:i,placeholder:s,onChange:t=>r(n,t.target.value),onBlur:c,style:{display:"block",font:"inherit",width:"100%",color:u.palette.text.primary,backgroundColor:u.palette.action.disabledBackground}})]}):"textarea"===e?(0,g.jsxs)(l.A,{margin:1,children:[(0,g.jsx)("label",{htmlFor:n,children:a}),(0,g.jsx)(f.h,{id:n,minRows:"content"===n?5:d,required:o,value:i,placeholder:s,onChange:t=>r(n,t.target.value),onBlur:c,style:{display:"block",font:"inherit",width:"100%",color:u.palette.text.primary,backgroundColor:u.palette.action.disabledBackground}})]}):null},A=t=>{let{id:e,valid:n,touched:o,onChange:i,onBlur:s}=t;const r=(0,y.A)(),[c,d]=(0,a.useState)("");return(0,g.jsxs)(l.A,{margin:1,children:[(0,g.jsx)("input",{type:"file",id:e,onChange:t=>{t.target.files&&(i(e,t.target.value,t.target.files),d(t.target.files.length>0?t.target.files[0].name:""))},onBlur:s,style:{display:"none"}}),(0,g.jsx)("label",{htmlFor:e,style:{display:"block",width:"100%",border:"1px solid #808080",color:r.palette.text.primary,backgroundColor:r.palette.action.disabledBackground},children:c||"Choose file"})]})};var k=n(2220),C=n(9352);const b={title:{value:"",valid:!1,touched:!1,validators:[C.mw,(0,C.Bw)({min:5})]},image:{value:"",valid:!1,touched:!1,validators:[C.mw]},content:{value:"",valid:!1,touched:!1,validators:[C.mw,(0,C.Bw)({min:5})]}},_=t=>{const[e,n]=(0,a.useState)(b),[o,l]=(0,a.useState)(!1),[i,s]=(0,a.useState)(null);(0,a.useEffect)((()=>{if(t.editing&&t.selectedPost&&(e.title.value!==t.selectedPost.title||e.image.value!==t.selectedPost.imagePath||e.content.value!==t.selectedPost.content)){const a={...e,title:{...e.title,value:t.selectedPost.title,valid:!0},image:{...e.image,value:t.selectedPost.imagePath,valid:!0},content:{...e.content,value:t.selectedPost.content,valid:!0}};n(a),l(!0)}}),[t.editing,t.selectedPost]);const r=(0,a.useCallback)(((t,a,o)=>{o&&(t=>{const e=new FileReader,n=new Promise(((t,n)=>{e.onload=e=>t(e.target.result),e.onerror=n}));return e.readAsDataURL(t),n})(o[0]).then((t=>{s(t)})).catch((t=>{s(null)}));let i=!0;for(const n of e[t].validators)i=i&&n(a);const r={...e,[t]:{...e[t],valid:i,value:o?o[0]:a}};let c=!0;for(const e in r)c=c&&r[e].valid;n(r),l(c)}),[e]),c=(0,a.useCallback)((t=>{n((e=>({...e,[t]:{...e[t],touched:!0}})))}),[]),d=(0,a.useCallback)((()=>{n(b),l(!1),t.onCancelEdit()}),[t]),u=(0,a.useCallback)((()=>{const a={title:e.title.value,image:e.image.value,content:e.content.value};t.onFinishEdit(a),n(b),l(!1),s(null)}),[e,t]);return t.editing?(0,g.jsxs)(a.Fragment,{children:[(0,g.jsx)(k.A,{open:t.editing,onClick:d}),(0,g.jsx)(j.A,{open:t.editing,title:"New Post",acceptEnabled:o,onCancelModal:d,onAcceptModal:u,isLoading:t.loading,children:(0,g.jsxs)("form",{children:[(0,g.jsx)(w,{id:"title",label:"Title",control:"input",onChange:r,onBlur:()=>c("title"),valid:e.title.valid,touched:e.title.touched,value:e.title.value}),(0,g.jsx)(A,{id:"image",label:"Image",control:"input",onChange:r,onBlur:()=>c("image"),valid:e.image.valid,touched:e.image.touched}),(0,g.jsxs)("div",{children:[!i&&(0,g.jsx)("p",{style:{textAlign:"center"},children:"Please choose an image."}),i&&(0,g.jsx)("img",{src:i,alt:e.title.value,style:{width:"200px"}})]}),(0,g.jsx)(w,{id:"content",label:"Content",control:"textarea",onChange:r,onBlur:()=>c("content"),valid:e.content.valid,touched:e.content.touched,value:e.content.value})]})})]}):null};var S=n(3571),P=n(7154);const B=t=>{const[e,n]=(0,a.useState)(!1),[d,u]=(0,a.useState)([]),[h,p]=(0,a.useState)(0),[m,j]=(0,a.useState)(null),[y,f]=(0,a.useState)(""),[A,k]=(0,a.useState)(1),[C,b]=(0,a.useState)(!0),[B,E]=(0,a.useState)(!1),[F,z]=(0,a.useState)(null),D=(0,a.useRef)(),I=(0,a.useCallback)((t=>{u((e=>{const n=[...e];return n.some((e=>e._id===t._id))||(n.unshift(t),n.length>2&&n.pop()),n})),p((t=>t+1))}),[]);P.A.defaults.headers.common.Authorization="Bearer "+t.token,(0,a.useEffect)((()=>{const t=async()=>{try{const t=await P.A.get("https://mern-social-network-416113.ey.r.appspot.com/feed/posts?page="+A);u(t.data.posts),p(t.data.totalItems),b(!1)}catch(F){N(F)}};(async()=>{try{const t=await P.A.get("https://mern-social-network-416113.ey.r.appspot.com/auth/status");f(t.data.status)}catch(F){N(F)}})(),t(),D.current=(0,o.Ay)("https://mern-social-network-416113.ey.r.appspot.com"),D.current.on("posts",(e=>{"create"===e.action?I(e.post):"update"===e.action?R(e.post):"delete"===e.action&&t()}))}),[t.token,A,I]);const R=t=>{u((e=>{const n=[...e],a=n.findIndex((e=>e._id===t._id));return a>-1&&(n[a]=t),n}))},U=async t=>{t&&(b(!0),u([]));let e=A;"next"===t&&(e++,k(e)),"previous"===t&&(e--,k(e));try{const t=await P.A.get("https://mern-social-network-416113.ey.r.appspot.com/feed/posts?page="+e,{validateStatus:function(t){return!0}});if(200!==t.status)throw new Error("Failed to fetch posts.");u(t.data.posts.map((t=>({...t,imagePath:t.imageUrl})))),p(t.data.totalItems),b(!1)}catch(n){N(n)}},N=t=>{z(t)};return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(S.A,{error:F,onHandle:()=>{z(null)}}),(0,g.jsx)(_,{editing:e,selectedPost:m,loading:B,onCancelEdit:()=>{n(!1),j(null)},onFinishEdit:async t=>{E(!0);const e=new FormData;e.append("title",t.title),e.append("content",t.content),e.append("image",t.image);let a="https://mern-social-network-416113.ey.r.appspot.com/feed/post",o="POST";m&&(a="https://mern-social-network-416113.ey.r.appspot.com/feed/post/"+m._id,o="PUT");try{const t=await(0,P.A)({url:a,method:o,data:e,validateStatus:function(t){return!0}});if(200!==t.status&&201!==t.status)throw new Error("Creating or editing a post failed!");console.log(t.data),n(!1),j(null),E(!1)}catch(l){n(!1),j(null),E(!1),z(l)}}}),(0,g.jsx)(l.A,{sx:{width:"90%",margin:"1rem auto",position:"sticky",top:0,zIndex:1},children:(0,g.jsx)("form",{onSubmit:t=>{t.preventDefault(),P.A.patch("https://mern-social-network-416113.ey.r.appspot.com/auth/status",{status:y}).then((t=>{console.log(t.data)})).catch(N)},children:(0,g.jsxs)(i.Ay,{container:!0,alignItems:"center",justifyContent:"center",spacing:1,children:[(0,g.jsx)(i.Ay,{item:!0,children:(0,g.jsx)(w,{type:"text",placeholder:"Your status",control:"input",onChange:(t,e)=>{f(e)},value:y})}),(0,g.jsx)(i.Ay,{item:!0,children:(0,g.jsx)(v,{mode:"flat",type:"submit",children:"Update"})})]})})}),(0,g.jsx)(l.A,{textAlign:"center",children:(0,g.jsx)(v,{mode:"raised",design:"accent",onClick:()=>{n(!0)},children:"New Post"})}),(0,g.jsxs)("section",{children:[C&&(0,g.jsx)(l.A,{textAlign:"center",marginTop:"2rem",children:(0,g.jsx)(s.A,{})}),d.length<=0&&!C?(0,g.jsx)(r.A,{align:"center",children:"No posts found."}):null,!C&&(0,g.jsxs)(g.Fragment,{children:[d.map((t=>(0,g.jsx)(x,{id:t._id,author:t.creator.name,date:new Date(t.createdAt).toLocaleDateString("en-US"),title:t.title,image:t.imageUrl,content:t.content,onStartEdit:()=>(t=>{const e={...d.find((e=>e._id===t))};n(!0),j(e)})(t._id),onDelete:()=>(async t=>{b(!0);try{const e=await P.A.delete("https://mern-social-network-416113.ey.r.appspot.com/feed/post/"+t);console.log(e.data),U()}catch(e){console.log(e),b(!1)}})(t._id)},t._id))),(0,g.jsx)(l.A,{display:"flex",justifyContent:"center",children:(0,g.jsx)(c.A,{count:Math.ceil(h/2),page:A,onChange:(t,e)=>{e<A?U("previous"):e>A&&U("next")}})})]})]})]})}},9352:(t,e,n)=>{n.d(e,{Bw:()=>o,Rp:()=>l,mw:()=>a});const a=t=>""!==t.trim(),o=t=>e=>{let n=!0;return t.min&&(n=n&&e.trim().length>=t.min),t.max&&(n=n&&e.trim().length<=t.max),n},l=t=>/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t)}}]);
//# sourceMappingURL=466.71db0af5.chunk.js.map