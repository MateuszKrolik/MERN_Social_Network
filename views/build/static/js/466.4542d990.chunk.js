"use strict";(self.webpackChunknode_complete_social_network_prep=self.webpackChunknode_complete_social_network_prep||[]).push([[466],{2466:(e,t,a)=>{a.r(t),a.d(t,{default:()=>P});var n=a(5043),l=a(6446),o=a(8903),i=a(1637),s=a(5865),r=a(9135),c=a(2110),d=a(6494),u=a(7600),h=a(1906),p=a(5475),g=a(579);const m=e=>{let{author:t,date:a,title:n,id:l,onStartEdit:o,onDelete:i}=e;return(0,g.jsxs)(c.A,{sx:{m:2,width:"70%",mx:"auto"},children:[(0,g.jsxs)(d.A,{children:[(0,g.jsxs)(s.A,{variant:"body1",color:"text.secondary",children:["Posted by ",t," on ",a]}),(0,g.jsx)(s.A,{variant:"h5",color:"text.primary",children:n})]}),(0,g.jsxs)(u.A,{sx:{justifyContent:"flex-end"},children:[(0,g.jsx)(p.N_,{to:l,children:(0,g.jsx)(h.A,{variant:"text",children:"View"})}),(0,g.jsx)(h.A,{variant:"text",onClick:o,children:"Edit"}),(0,g.jsx)(h.A,{variant:"text",color:"error",onClick:i,children:"Delete"})]})]})},x=e=>{let{link:t,onClick:a,disabled:n,loading:l,type:o,children:i}=e;return t?(0,g.jsx)(h.A,{component:p.N_,to:t,children:i}):(0,g.jsx)(h.A,{onClick:a,disabled:n||l,type:o,variant:"contained",style:{backgroundColor:"#fab83f"},children:l?"Loading...":i})};var j=a(8935),v=a(6240),k=a(1130);const f=e=>{let{control:t,id:a,label:n,required:o,value:i,placeholder:s,onChange:r,onBlur:c,minRows:d}=e;const u=(0,v.A)();return"input"===t?(0,g.jsxs)(l.A,{margin:1,children:[(0,g.jsx)("label",{htmlFor:a,children:n}),(0,g.jsx)(k.h,{id:a,required:o,value:i,placeholder:s,onChange:e=>r(a,e.target.value),onBlur:c,style:{display:"block",font:"inherit",width:"100%",color:u.palette.text.primary,backgroundColor:u.palette.action.disabledBackground}})]}):"textarea"===t?(0,g.jsxs)(l.A,{margin:1,children:[(0,g.jsx)("label",{htmlFor:a,children:n}),(0,g.jsx)(k.h,{id:a,minRows:"content"===a?5:d,required:o,value:i,placeholder:s,onChange:e=>r(a,e.target.value),onBlur:c,style:{display:"block",font:"inherit",width:"100%",color:u.palette.text.primary,backgroundColor:u.palette.action.disabledBackground}})]}):null},w=e=>{let{id:t,valid:a,touched:o,onChange:i,onBlur:s}=e;const r=(0,v.A)(),[c,d]=(0,n.useState)("");return(0,g.jsxs)(l.A,{margin:1,children:[(0,g.jsx)("input",{type:"file",id:t,onChange:e=>{e.target.files&&(i(t,e.target.value,e.target.files),d(e.target.files.length>0?e.target.files[0].name:""))},onBlur:s,style:{display:"none"}}),(0,g.jsx)("label",{htmlFor:t,style:{display:"block",width:"100%",border:"1px solid #808080",color:r.palette.text.primary,backgroundColor:r.palette.action.disabledBackground},children:c||"Choose file"})]})};var A=a(2220),y=a(9352);const b={title:{value:"",valid:!1,touched:!1,validators:[y.mw,(0,y.Bw)({min:5})]},image:{value:"",valid:!1,touched:!1,validators:[y.mw]},content:{value:"",valid:!1,touched:!1,validators:[y.mw,(0,y.Bw)({min:5})]}},C=e=>{const[t,a]=(0,n.useState)(b),[l,o]=(0,n.useState)(!1),[i,s]=(0,n.useState)(null);(0,n.useEffect)((()=>{if(e.editing&&e.selectedPost&&(t.title.value!==e.selectedPost.title||t.image.value!==e.selectedPost.imagePath||t.content.value!==e.selectedPost.content)){const n={...t,title:{...t.title,value:e.selectedPost.title,valid:!0},image:{...t.image,value:e.selectedPost.imagePath,valid:!0},content:{...t.content,value:e.selectedPost.content,valid:!0}};a(n),o(!0)}}),[e.editing,e.selectedPost]);const r=(0,n.useCallback)(((e,n,l)=>{l&&(e=>{const t=new FileReader,a=new Promise(((e,a)=>{t.onload=t=>e(t.target.result),t.onerror=a}));return t.readAsDataURL(e),a})(l[0]).then((e=>{s(e)})).catch((e=>{s(null)}));let i=!0;for(const a of t[e].validators)i=i&&a(n);const r={...t,[e]:{...t[e],valid:i,value:l?l[0]:n}};let c=!0;for(const t in r)c=c&&r[t].valid;a(r),o(c)}),[t]),c=(0,n.useCallback)((e=>{a((t=>({...t,[e]:{...t[e],touched:!0}})))}),[]),d=(0,n.useCallback)((()=>{a(b),o(!1),e.onCancelEdit()}),[e]),u=(0,n.useCallback)((()=>{const n={title:t.title.value,image:t.image.value,content:t.content.value};e.onFinishEdit(n),a(b),o(!1),s(null)}),[t,e]);return e.editing?(0,g.jsxs)(n.Fragment,{children:[(0,g.jsx)(A.A,{open:e.editing,onClick:d}),(0,g.jsx)(j.A,{open:e.editing,title:"New Post",acceptEnabled:l,onCancelModal:d,onAcceptModal:u,isLoading:e.loading,children:(0,g.jsxs)("form",{children:[(0,g.jsx)(f,{id:"title",label:"Title",control:"input",onChange:r,onBlur:()=>c("title"),valid:t.title.valid,touched:t.title.touched,value:t.title.value}),(0,g.jsx)(w,{id:"image",label:"Image",control:"input",onChange:r,onBlur:()=>c("image"),valid:t.image.valid,touched:t.image.touched}),(0,g.jsxs)("div",{children:[!i&&(0,g.jsx)("p",{style:{textAlign:"center"},children:"Please choose an image."}),i&&(0,g.jsx)("img",{src:i,alt:t.title.value,style:{width:"200px"}})]}),(0,g.jsx)(f,{id:"content",label:"Content",control:"textarea",onChange:r,onBlur:()=>c("content"),valid:t.content.valid,touched:t.content.touched,value:t.content.value})]})})]}):null};var S=a(3571),_=a(7154);const P=e=>{const[t,a]=(0,n.useState)(!1),[c,d]=(0,n.useState)([]),[u,h]=(0,n.useState)(0),[p,j]=(0,n.useState)(null),[v,k]=(0,n.useState)(""),[w,A]=(0,n.useState)(1),[y,b]=(0,n.useState)(!0),[P,B]=(0,n.useState)(!1),[E,F]=(0,n.useState)(null),z=(0,n.useCallback)((e=>{d((t=>{const a=[...t];return a.some((t=>t._id===e._id))||(a.unshift(e),a.length>2&&a.pop()),a})),h((e=>e+1))}),[]);_.A.defaults.headers.common.Authorization="Bearer "+e.token,(0,n.useEffect)((()=>{(async()=>{try{const e=await _.A.get("https://mkrolik-social-api-de4b456-s7k2op5jka-ew.a.run.app/auth/status");k(e.data.status)}catch(E){U(E)}})(),(async()=>{try{const e=await _.A.get("https://mkrolik-social-api-de4b456-s7k2op5jka-ew.a.run.app/feed/posts?page="+w);d(e.data.posts),h(e.data.totalItems),b(!1)}catch(E){U(E)}})()}),[e.token,w,z]);const D=async e=>{e&&(b(!0),d([]));let t=w;"next"===e&&(t++,A(t)),"previous"===e&&(t--,A(t));try{const e=await _.A.get("https://mkrolik-social-api-de4b456-s7k2op5jka-ew.a.run.app/feed/posts?page="+t,{validateStatus:function(e){return!0}});if(200!==e.status)throw new Error("Failed to fetch posts.");d(e.data.posts.map((e=>({...e,imagePath:e.imageUrl})))),h(e.data.totalItems),b(!1)}catch(a){U(a)}},U=e=>{F(e)};return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(S.A,{error:E,onHandle:()=>{F(null)}}),(0,g.jsx)(C,{editing:t,selectedPost:p,loading:P,onCancelEdit:()=>{a(!1),j(null)},onFinishEdit:async e=>{B(!0);const t=new FormData;t.append("title",e.title),t.append("content",e.content),t.append("image",e.image);let n="https://mkrolik-social-api-de4b456-s7k2op5jka-ew.a.run.app/feed/post",l="POST";p&&(n="https://mkrolik-social-api-de4b456-s7k2op5jka-ew.a.run.app/feed/post/"+p._id,l="PUT");try{const e=await(0,_.A)({url:n,method:l,data:t,validateStatus:function(e){return!0}});if(200!==e.status&&201!==e.status)throw new Error("Creating or editing a post failed!");console.log(e.data),a(!1),j(null),B(!1)}catch(o){a(!1),j(null),B(!1),F(o)}}}),(0,g.jsx)(l.A,{sx:{width:"90%",margin:"1rem auto",position:"sticky",top:0,zIndex:1},children:(0,g.jsx)("form",{onSubmit:e=>{e.preventDefault(),_.A.patch("https://mkrolik-social-api-de4b456-s7k2op5jka-ew.a.run.app/auth/status",{status:v}).then((e=>{console.log(e.data)})).catch(U)},children:(0,g.jsxs)(o.Ay,{container:!0,alignItems:"center",justifyContent:"center",spacing:1,children:[(0,g.jsx)(o.Ay,{item:!0,children:(0,g.jsx)(f,{type:"text",placeholder:"Your status",control:"input",onChange:(e,t)=>{k(t)},value:v})}),(0,g.jsx)(o.Ay,{item:!0,children:(0,g.jsx)(x,{mode:"flat",type:"submit",children:"Update"})})]})})}),(0,g.jsx)(l.A,{textAlign:"center",children:(0,g.jsx)(x,{mode:"raised",design:"accent",onClick:()=>{a(!0)},children:"New Post"})}),(0,g.jsxs)("section",{children:[y&&(0,g.jsx)(l.A,{textAlign:"center",marginTop:"2rem",children:(0,g.jsx)(i.A,{})}),c.length<=0&&!y?(0,g.jsx)(s.A,{align:"center",children:"No posts found."}):null,!y&&(0,g.jsxs)(g.Fragment,{children:[c.map((e=>(0,g.jsx)(m,{id:e._id,author:e.creator.name,date:new Date(e.createdAt).toLocaleDateString("en-US"),title:e.title,image:e.imageUrl,content:e.content,onStartEdit:()=>(e=>{const t={...c.find((t=>t._id===e))};a(!0),j(t)})(e._id),onDelete:()=>(async e=>{b(!0);try{const t=await _.A.delete("https://mkrolik-social-api-de4b456-s7k2op5jka-ew.a.run.app/feed/post/"+e);console.log(t.data),D()}catch(t){console.log(t),b(!1)}})(e._id)},e._id))),(0,g.jsx)(l.A,{display:"flex",justifyContent:"center",children:(0,g.jsx)(r.A,{count:Math.ceil(u/2),page:w,onChange:(e,t)=>{t<w?D("previous"):t>w&&D("next")}})})]})]})]})}},9352:(e,t,a)=>{a.d(t,{Bw:()=>l,Rp:()=>o,mw:()=>n});const n=e=>""!==e.trim(),l=e=>t=>{let a=!0;return e.min&&(a=a&&t.trim().length>=e.min),e.max&&(a=a&&t.trim().length<=e.max),a},o=e=>/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(e)}}]);
//# sourceMappingURL=466.4542d990.chunk.js.map