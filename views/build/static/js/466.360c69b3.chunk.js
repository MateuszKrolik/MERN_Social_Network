"use strict";(self.webpackChunknode_complete_social_network_prep=self.webpackChunknode_complete_social_network_prep||[]).push([[466],{2466:(t,e,a)=>{a.r(e),a.d(e,{default:()=>P});var n=a(5043),l=a(6446),o=a(8903),i=a(1637),s=a(5865),r=a(9135),c=a(2110),d=a(6494),u=a(7600),h=a(1906),p=a(5475),m=a(579);const g=t=>{let{author:e,date:a,title:n,id:l,onStartEdit:o,onDelete:i}=t;return(0,m.jsxs)(c.A,{sx:{m:2,width:"70%",mx:"auto"},children:[(0,m.jsxs)(d.A,{children:[(0,m.jsxs)(s.A,{variant:"body1",color:"text.secondary",children:["Posted by ",e," on ",a]}),(0,m.jsx)(s.A,{variant:"h5",color:"text.primary",children:n})]}),(0,m.jsxs)(u.A,{sx:{justifyContent:"flex-end"},children:[(0,m.jsx)(p.N_,{to:l,children:(0,m.jsx)(h.A,{variant:"text",children:"View"})}),(0,m.jsx)(h.A,{variant:"text",onClick:o,children:"Edit"}),(0,m.jsx)(h.A,{variant:"text",color:"error",onClick:i,children:"Delete"})]})]})},x=t=>{let{link:e,onClick:a,disabled:n,loading:l,type:o,children:i}=t;return e?(0,m.jsx)(h.A,{component:p.N_,to:e,children:i}):(0,m.jsx)(h.A,{onClick:a,disabled:n||l,type:o,variant:"contained",style:{backgroundColor:"#fab83f"},children:l?"Loading...":i})};var j=a(8935),v=a(6240),f=a(1130);const k=t=>{let{control:e,id:a,label:n,required:o,value:i,placeholder:s,onChange:r,onBlur:c,minRows:d}=t;const u=(0,v.A)();return"input"===e?(0,m.jsxs)(l.A,{margin:1,children:[(0,m.jsx)("label",{htmlFor:a,children:n}),(0,m.jsx)(f.h,{id:a,required:o,value:i,placeholder:s,onChange:t=>r(a,t.target.value),onBlur:c,style:{display:"block",font:"inherit",width:"100%",color:u.palette.text.primary,backgroundColor:u.palette.action.disabledBackground}})]}):"textarea"===e?(0,m.jsxs)(l.A,{margin:1,children:[(0,m.jsx)("label",{htmlFor:a,children:n}),(0,m.jsx)(f.h,{id:a,minRows:"content"===a?5:d,required:o,value:i,placeholder:s,onChange:t=>r(a,t.target.value),onBlur:c,style:{display:"block",font:"inherit",width:"100%",color:u.palette.text.primary,backgroundColor:u.palette.action.disabledBackground}})]}):null},A=t=>{let{id:e,valid:a,touched:o,onChange:i,onBlur:s}=t;const r=(0,v.A)(),[c,d]=(0,n.useState)("");return(0,m.jsxs)(l.A,{margin:1,children:[(0,m.jsx)("input",{type:"file",id:e,onChange:t=>{t.target.files&&(i(e,t.target.value,t.target.files),d(t.target.files.length>0?t.target.files[0].name:""))},onBlur:s,style:{display:"none"}}),(0,m.jsx)("label",{htmlFor:e,style:{display:"block",width:"100%",border:"1px solid #808080",color:r.palette.text.primary,backgroundColor:r.palette.action.disabledBackground},children:c||"Choose file"})]})};var y=a(2220),C=a(9352);const w={title:{value:"",valid:!1,touched:!1,validators:[C.mw,(0,C.Bw)({min:5})]},image:{value:"",valid:!1,touched:!1,validators:[C.mw]},content:{value:"",valid:!1,touched:!1,validators:[C.mw,(0,C.Bw)({min:5})]}},b=t=>{const[e,a]=(0,n.useState)(w),[l,o]=(0,n.useState)(!1),[i,s]=(0,n.useState)(null);(0,n.useEffect)((()=>{if(t.editing&&t.selectedPost&&(e.title.value!==t.selectedPost.title||e.image.value!==t.selectedPost.imagePath||e.content.value!==t.selectedPost.content)){const n={...e,title:{...e.title,value:t.selectedPost.title,valid:!0},image:{...e.image,value:t.selectedPost.imagePath,valid:!0},content:{...e.content,value:t.selectedPost.content,valid:!0}};a(n),o(!0)}}),[t.editing,t.selectedPost]);const r=(0,n.useCallback)(((t,n,l)=>{l&&(t=>{const e=new FileReader,a=new Promise(((t,a)=>{e.onload=e=>t(e.target.result),e.onerror=a}));return e.readAsDataURL(t),a})(l[0]).then((t=>{s(t)})).catch((t=>{s(null)}));let i=!0;for(const a of e[t].validators)i=i&&a(n);const r={...e,[t]:{...e[t],valid:i,value:l?l[0]:n}};let c=!0;for(const e in r)c=c&&r[e].valid;a(r),o(c)}),[e]),c=(0,n.useCallback)((t=>{a((e=>({...e,[t]:{...e[t],touched:!0}})))}),[]),d=(0,n.useCallback)((()=>{a(w),o(!1),t.onCancelEdit()}),[t]),u=(0,n.useCallback)((()=>{const n={title:e.title.value,image:e.image.value,content:e.content.value};t.onFinishEdit(n),a(w),o(!1),s(null)}),[e,t]);return t.editing?(0,m.jsxs)(n.Fragment,{children:[(0,m.jsx)(y.A,{open:t.editing,onClick:d}),(0,m.jsx)(j.A,{open:t.editing,title:"New Post",acceptEnabled:l,onCancelModal:d,onAcceptModal:u,isLoading:t.loading,children:(0,m.jsxs)("form",{children:[(0,m.jsx)(k,{id:"title",label:"Title",control:"input",onChange:r,onBlur:()=>c("title"),valid:e.title.valid,touched:e.title.touched,value:e.title.value}),(0,m.jsx)(A,{id:"image",label:"Image",control:"input",onChange:r,onBlur:()=>c("image"),valid:e.image.valid,touched:e.image.touched}),(0,m.jsxs)("div",{children:[!i&&(0,m.jsx)("p",{style:{textAlign:"center"},children:"Please choose an image."}),i&&(0,m.jsx)("img",{src:i,alt:e.title.value,style:{width:"200px"}})]}),(0,m.jsx)(k,{id:"content",label:"Content",control:"textarea",onChange:r,onBlur:()=>c("content"),valid:e.content.valid,touched:e.content.touched,value:e.content.value})]})})]}):null};var S=a(3571),_=a(7154);const P=t=>{const[e,a]=(0,n.useState)(!1),[c,d]=(0,n.useState)([]),[u,h]=(0,n.useState)(0),[p,j]=(0,n.useState)(null),[v,f]=(0,n.useState)(""),[A,y]=(0,n.useState)(1),[C,w]=(0,n.useState)(!0),[P,B]=(0,n.useState)(!1),[E,F]=(0,n.useState)(null),z=(0,n.useCallback)((t=>{d((e=>{const a=[...e];return a.some((e=>e._id===t._id))||(a.unshift(t),a.length>2&&a.pop()),a})),h((t=>t+1))}),[]);_.A.defaults.headers.common.Authorization="Bearer "+t.token,(0,n.useEffect)((()=>{(async()=>{try{const t=await _.A.get("https://mern-social-api-s7k2op5jka-lm.a.run.app/auth/status");f(t.data.status)}catch(E){U(E)}})(),(async()=>{try{const t=await _.A.get("https://mern-social-api-s7k2op5jka-lm.a.run.app/feed/posts?page="+A);d(t.data.posts),h(t.data.totalItems),w(!1)}catch(E){U(E)}})()}),[t.token,A,z]);const D=async t=>{t&&(w(!0),d([]));let e=A;"next"===t&&(e++,y(e)),"previous"===t&&(e--,y(e));try{const t=await _.A.get("https://mern-social-api-s7k2op5jka-lm.a.run.app/feed/posts?page="+e,{validateStatus:function(t){return!0}});if(200!==t.status)throw new Error("Failed to fetch posts.");d(t.data.posts.map((t=>({...t,imagePath:t.imageUrl})))),h(t.data.totalItems),w(!1)}catch(a){U(a)}},U=t=>{F(t)};return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(S.A,{error:E,onHandle:()=>{F(null)}}),(0,m.jsx)(b,{editing:e,selectedPost:p,loading:P,onCancelEdit:()=>{a(!1),j(null)},onFinishEdit:async t=>{B(!0);const e=new FormData;e.append("title",t.title),e.append("content",t.content),e.append("image",t.image);let n="https://mern-social-api-s7k2op5jka-lm.a.run.app/feed/post",l="POST";p&&(n="https://mern-social-api-s7k2op5jka-lm.a.run.app/feed/post/"+p._id,l="PUT");try{const t=await(0,_.A)({url:n,method:l,data:e,validateStatus:function(t){return!0}});if(200!==t.status&&201!==t.status)throw new Error("Creating or editing a post failed!");console.log(t.data),a(!1),j(null),B(!1)}catch(o){a(!1),j(null),B(!1),F(o)}}}),(0,m.jsx)(l.A,{sx:{width:"90%",margin:"1rem auto",position:"sticky",top:0,zIndex:1},children:(0,m.jsx)("form",{onSubmit:t=>{t.preventDefault(),_.A.patch("https://mern-social-api-s7k2op5jka-lm.a.run.app/auth/status",{status:v}).then((t=>{console.log(t.data)})).catch(U)},children:(0,m.jsxs)(o.Ay,{container:!0,alignItems:"center",justifyContent:"center",spacing:1,children:[(0,m.jsx)(o.Ay,{item:!0,children:(0,m.jsx)(k,{type:"text",placeholder:"Your status",control:"input",onChange:(t,e)=>{f(e)},value:v})}),(0,m.jsx)(o.Ay,{item:!0,children:(0,m.jsx)(x,{mode:"flat",type:"submit",children:"Update"})})]})})}),(0,m.jsx)(l.A,{textAlign:"center",children:(0,m.jsx)(x,{mode:"raised",design:"accent",onClick:()=>{a(!0)},children:"New Post"})}),(0,m.jsxs)("section",{children:[C&&(0,m.jsx)(l.A,{textAlign:"center",marginTop:"2rem",children:(0,m.jsx)(i.A,{})}),c.length<=0&&!C?(0,m.jsx)(s.A,{align:"center",children:"No posts found."}):null,!C&&(0,m.jsxs)(m.Fragment,{children:[c.map((t=>(0,m.jsx)(g,{id:t._id,author:t.creator.name,date:new Date(t.createdAt).toLocaleDateString("en-US"),title:t.title,image:t.imageUrl,content:t.content,onStartEdit:()=>(t=>{const e={...c.find((e=>e._id===t))};a(!0),j(e)})(t._id),onDelete:()=>(async t=>{w(!0);try{const e=await _.A.delete("https://mern-social-api-s7k2op5jka-lm.a.run.app/feed/post/"+t);console.log(e.data),D()}catch(e){console.log(e),w(!1)}})(t._id)},t._id))),(0,m.jsx)(l.A,{display:"flex",justifyContent:"center",children:(0,m.jsx)(r.A,{count:Math.ceil(u/2),page:A,onChange:(t,e)=>{e<A?D("previous"):e>A&&D("next")}})})]})]})]})}},9352:(t,e,a)=>{a.d(e,{Bw:()=>l,Rp:()=>o,mw:()=>n});const n=t=>""!==t.trim(),l=t=>e=>{let a=!0;return t.min&&(a=a&&e.trim().length>=t.min),t.max&&(a=a&&e.trim().length<=t.max),a},o=t=>/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/.test(t)}}]);
//# sourceMappingURL=466.360c69b3.chunk.js.map